/**
    jExtract: a function for extracting data from DOM.
    Version: 1.0.0
    Author: Mikhail Kormanowsky (@kormanowsky)
    Date: 17.07.2020
*/
!function(){"use strict";!function(){const t="object"==typeof window;let e,n,r=t?window.document:null;if(t)e=window.jQuery;else{n=require("node-html-parser");try{e=require("jquery")}catch(t){e=null}}class i extends Error{constructor(t){super(),this.name="JExtractError",this.message=t}}class s{static NaN(t){return s.NaN(t)}static null(t){return null===t}static undefined(t){return void 0===t}static object(t){return"object"==typeof t&&t instanceof Object&&!(t instanceof Array)}static array(t){return"object"==typeof t&&t instanceof Array}static emptyArray(t){return this.array(t)&&!t.length}static function(t){return"function"==typeof t}static jQuery(t){return e&&t instanceof e}static jExtractElement(t){return t instanceof o}static NodeList(e){return t?e instanceof window.NodeList:this.array(e)}static string(t){return"string"==typeof t}static emptyString(t){return this.string(t)&&!t.length}static CSSSelector(e){if(!this.string(e)||this.emptyString(e))return!1;if(t)try{return r.querySelector(e),!0}catch(t){return!1}else{const t=new(0,require("css-selector-parser").CssSelectorParser);try{return t.parse(e),!0}catch(t){return!1}}}static JSON(t){if(!this.string(t)||this.emptyString(t))return!1;try{t=JSON.parse(t)}catch(t){return!1}return!0}static HTML(t){return!(!this.string(t)||this.emptyString(t))&&("<"==(t=t.trim())[0]&&">"==t[t.length-1])}}class c{constructor(t){this.text=t}get(t){return(t=t||!0)?this.text.trim():this.text}match(t,e){let n=this.get().match(new RegExp(t));return!s.undefined(e)&&s.array(n)&&e in n?n[e]:n}toInt(t){return t=t||!1,!s.NaN(parseInt(this.get()))||t?parseInt(this.get()):0}toFloat(t){t=t||!1;let e=this.get().replace(",",".");return!s.NaN(parseFloat(e))||t?parseFloat(e):0}}class o{constructor(t){this.element=t}text(){return this.element.innerText||this.element.textContent||this.element.text}attr(t){return this.element.getAttribute(t)}get(){return this.element}}function a(t,e){if(!t.get())throw new i("Incorrect parent element or selector");if("."==e)return[t];{if(!s.CSSSelector(e))throw new i("Could not find elements that match given selector: "+e);let n=t.get().querySelectorAll(e),r=[];return n=s.NodeList(n)?n:[n],l(n,(function(t,e,n){r[e]=new o(t)})),r}}function u(t,e){let n=e[0],r=e[1];return s.undefined(t)||(s.string(t)||s.function(t)?n=t:s.array(t)&&!s.empt.array(t)&&(n=t[0],t.length>1&&(r=t.slice(1)))),[n,r]}function l(t,e){if(s.array(t)||s.NodeList(t))t.forEach(e);else if(s.object(t))for(let n in t){e(t[n],n,t)}}function f(h,g){let p,y={};if(h=h||{},(g=s.object(g)?g:{}).json=g.json||!1,!g.parent){if(!t)throw new i("Parent element is not specified.");g.parent=new o(r)}if(p=g.parent,!s.object(h)){if(!s.JSON(h))throw new i("Incorrect JSON");h=JSON.parse(h)}return s.string(p)&&(p=function(e){if(s.CSSSelector(e))return new o(r.querySelector(e));if(s.HTML(e)){let i;return t?(i=r.createElement("div"),i.innerHTML=e):(i=n.parse("<div></div>"),i.set_content(e)),new o(i)}}(p)),s.jQuery(p)&&(p=p[0]),s.jExtractElement(p)||(p=new o(p)),l(h,(function(t,n){if(s.object(t))return void(y[n]=f(t,p));let r,o,h=["text",[]],g=["get",[]],d={},m=[];s.string(t)?r=a(p,t):(r=a(p,t[0]),s.object(t[1])?o=t[1]:h=u(t[1],h),g=u(t[2],g),s.object(t[3])&&(d=t[3]),d.keepArray=d.keepArray||!1),l(r,(function(t,n){if(s.undefined(o)){let o=function(){},a=[],u=null;if(s.function(h[0]))o=h[0],a=[t,n,r].concat(h[1]);else if(s.string(h[0]))if(a=h[1],h[0]in t)o=t[h[0]],u=t;else{if(!e||!(h[0]in e(t.get())))throw new i("Undefined Element method: "+h[0]);o=e(t.get())[h[0]],u=e(t.get())}let l,f=o.apply(u,a);if(s.string(f)&&g[0]){if(o=function(){},a=[],u=null,f=new c(f),s.function(g[0]))o=g[0],a=[f.get(),n].concat(g[1]);else if(s.string(g[0]))if(a=g[1],g[0]in f)o=f[g[0]],u=f;else{if(!(g[0]in new String(f.get())))throw new i("Undefined Element method: "+g[0]);o=f.get()[g[0]],u=f.get()}l=o.apply(u,a)}else l=f;m.push(l)}else m.push(f(o,t))})),!d.keepAarray&&m.length<2&&(m=m[0]),y[n]=m})),g.json?JSON.stringify(y):y}f.extendText=function(t){l(t,(t,e)=>{c.prototype[e]=function(){return t.call(this,this)}})},f.extendElement=function(t){l(t,(t,e)=>{o.prototype[e]=function(){return t.call(this,this)}})},t?(window.jExtract=f,e&&(window.jQuery.fn.jExtract=function(t){return f(t,e(this))})):module.exports=f}()}();
